<!DOCTYPE html>
<!-- saved from url=(0053)https://docs.ckan.org/en/2.9/contributing/python.html -->
<html class="js flexbox canvas canvastext webgl no-touch geolocation postmessage no-websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers no-applicationcache svg inlinesvg smil svgclippaths" lang="en" style="">
 <!--<![endif]-->
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Python coding standards — CKAN 2.9.11 documentation
  </title>
  <script src="./python_files/modernizr.min.js.下载" type="text/javascript">
  </script>
  <script data-url_root="../" id="documentation_options" src="./python_files/documentation_options.js.下载" type="text/javascript">
  </script>
  <script src="./python_files/jquery.js.下载" type="text/javascript">
  </script>
  <script src="./python_files/underscore.js.下载" type="text/javascript">
  </script>
  <script src="./python_files/doctools.js.下载" type="text/javascript">
  </script>
  <script src="./python_files/language_data.js.下载" type="text/javascript">
  </script>
  <script async="async" src="./python_files/readthedocs-doc-embed.js.下载" type="text/javascript">
  </script>
  <script src="./python_files/theme.js.下载" type="text/javascript">
  </script>
  <link href="./python_files/theme.css" rel="stylesheet" type="text/css"/>
  <link href="./python_files/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="./python_files/custom.css" rel="stylesheet" type="text/css"/>
  <link href="https://docs.ckan.org/en/2.9/genindex.html" rel="index" title="Index"/>
  <link href="https://docs.ckan.org/en/2.9/search.html" rel="search" title="Search"/>
  <link href="https://docs.ckan.org/en/2.9/contributing/string-i18n.html" rel="next" title="String internationalization"/>
  <link href="https://docs.ckan.org/en/2.9/contributing/javascript.html" rel="prev" title="JavaScript coding standards"/>
  <!-- RTD Extra Head -->
  <link href="./python_files/readthedocs-doc-embed.css" rel="stylesheet" type="text/css"/>
  <script id="READTHEDOCS_DATA" type="application/json">
   {"ad_free": false, "api_host": "https://readthedocs.org", "builder": "sphinx", "canonical_url": null, "docroot": "/doc/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-1", "language": "en", "page": "contributing/python", "programming_language": "py", "project": "ckan", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {"ckanext-spatial": "https://docs.ckan.org/projects/ckanext-spatial/en/latest/"}, "theme": "sphinx_rtd_theme", "user_analytics_code": "UA-82993323-1", "version": "2.9"}
  </script>
  <!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
  <script type="text/javascript">
   READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
  </script>
  <script async="async" src="./python_files/readthedocs-analytics.js.下载" type="text/javascript">
  </script>
  <!-- end RTD <extrahead> -->
  <script async="" id="ethicaladsjs" src="./python_files/ethicalads.min.js.下载" type="text/javascript">
  </script>
 </head>
 <body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
   <nav class="wy-nav-side" data-toggle="wy-nav-shift">
    <div class="wy-side-scroll">
     <div class="wy-side-nav-search">
      <a href="https://docs.ckan.org/en/2.9/contents.html">
       <img alt="Logo" class="logo" src="./python_files/ckanlogo.webp"/>
      </a>
      <div class="version">
       2.9.11
      </div>
      <div role="search">
       <form action="https://docs.ckan.org/en/2.9/search.html" class="wy-form" id="rtd-search-form" method="get">
        <input name="q" placeholder="Search docs" type="text"/>
        <input name="check_keywords" type="hidden" value="yes"/>
        <input name="area" type="hidden" value="default"/>
       </form>
      </div>
     </div>
     <div aria-label="main navigation" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
      <ul class="current">
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/user-guide.html">
         User guide
        </a>
       </li>
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/sysadmin-guide.html">
         Sysadmin guide
        </a>
       </li>
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/maintaining/index.html">
         Maintainer’s guide
        </a>
       </li>
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/api/index.html">
         API guide
        </a>
       </li>
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/extensions/index.html">
         Extending guide
        </a>
       </li>
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/theming/index.html">
         Theming guide
        </a>
       </li>
       <li class="toctree-l1 current">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/index.html">
         <span class="toctree-expand">
         </span>
         Contributing guide
        </a>
        <ul class="">
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/issues.html">
           Reporting issues
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/i18n.html">
           Translating CKAN
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/test.html">
           Testing CKAN
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/commit-messages.html">
           Writing commit messages
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/pull-requests.html">
           Making a pull request
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/reviewing.html">
           Reviewing and merging a pull request
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/documentation.html">
           Writing documentation
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/simple-code-contributions.html">
           Projects for beginner CKAN developers
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/architecture.html">
           CKAN code architecture
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/css.html">
           CSS coding standards
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/html.html">
           HTML coding standards
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/javascript.html">
           JavaScript coding standards
          </a>
         </li>
         <li class="toctree-l2 current">
          <a class="reference internal current" href="https://docs.ckan.org/en/2.9/contributing/python.html#">
           <span class="toctree-expand">
           </span>
           Python coding standards
          </a>
          <ul>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#use-single-quotes">
             Use single quotes
            </a>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#imports">
             Imports
            </a>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#logging">
             Logging
            </a>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#string-formatting">
             String formatting
            </a>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#unicode-handling">
             Unicode handling
            </a>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#docstrings">
             <span class="toctree-expand">
             </span>
             Docstrings
            </a>
            <ul>
             <li class="toctree-l4">
              <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#pep-257-docstring-conventions">
               PEP 257 (Docstring Conventions)
              </a>
             </li>
            </ul>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#referencing-other-code-objects-with-py">
             <span class="toctree-expand">
             </span>
             Referencing other code objects with
             <code class="docutils literal notranslate">
              <span class="pre">
               :py:
              </span>
             </code>
            </a>
            <ul>
             <li class="toctree-l4">
              <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#documenting-exceptions-raised-with-raises">
               Documenting exceptions raised with
               <code class="docutils literal notranslate">
                <span class="pre">
                 :raises
                </span>
               </code>
              </a>
             </li>
             <li class="toctree-l4">
              <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#sphinx-field-lists">
               Sphinx field lists
              </a>
             </li>
             <li class="toctree-l4">
              <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#action-api-docstrings">
               Action API docstrings
              </a>
             </li>
            </ul>
           </li>
           <li class="toctree-l3">
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#some-helpful-tools-for-python-code-quality">
             Some helpful tools for Python code quality
            </a>
           </li>
          </ul>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/string-i18n.html">
           String internationalization
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/unicode.html">
           Unicode handling
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/testing.html">
           Testing coding standards
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/frontend/index.html">
           Frontend development guidelines
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/database-migrations.html">
           Database migrations
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/upgrading-dependencies.html">
           Upgrading CKAN’s dependencies
          </a>
         </li>
         <li class="toctree-l2">
          <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/release-process.html">
           Doing a CKAN release
          </a>
         </li>
        </ul>
       </li>
       <li class="toctree-l1">
        <a class="reference internal" href="https://docs.ckan.org/en/2.9/changelog.html">
         Changelog
        </a>
       </li>
      </ul>
     </div>
    </div>
   </nav>
   <section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
    <nav aria-label="top navigation" class="wy-nav-top">
     <i class="fa fa-bars" data-toggle="wy-nav-top">
     </i>
     <a href="https://docs.ckan.org/en/2.9/contents.html">
      CKAN
     </a>
    </nav>
    <div class="wy-nav-content">
     <div class="rst-content">
      <div aria-label="breadcrumbs navigation" role="navigation">
       <ul class="wy-breadcrumbs">
        <li>
         <a href="https://docs.ckan.org/en/2.9/contents.html">
          Docs
         </a>
         »
        </li>
        <li>
         <a href="https://docs.ckan.org/en/2.9/contributing/index.html">
          Contributing guide
         </a>
         »
        </li>
        <li>
         Python coding standards
        </li>
        <li class="wy-breadcrumbs-aside">
         <a class="fa fa-github" href="https://github.com/ckan/ckan/blob/2.9/doc/contributing/python.rst">
          Edit on GitHub
         </a>
        </li>
       </ul>
       <hr/>
      </div>
      <div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
       <div itemprop="articleBody">
        <div class="section" id="python-coding-standards">
         <h1>
          Python coding standards
          <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#python-coding-standards" title="Permalink to this headline">
           ¶
          </a>
         </h1>
         <p>
          For Python code style follow
          <a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">
           PEP 8
          </a>
          plus the guidelines below.
         </p>
         <p>
          Some good links about Python code style:
         </p>
         <ul class="simple">
          <li>
           <a class="reference external" href="http://docs.python-guide.org/en/latest/writing/style/">
            Guide to Python
           </a>
           from Hitchhiker’s
          </li>
          <li>
           <a class="reference external" href="https://google.github.io/styleguide/pyguide.html">
            Google Python Style Guide
           </a>
          </li>
         </ul>
         <div class="admonition seealso">
          <p class="first admonition-title">
           See also
          </p>
          <dl class="last docutils">
           <dt>
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/string-i18n.html">
             <span class="doc">
              String internationalization
             </span>
            </a>
           </dt>
           <dd>
            How to mark strings for translation.
           </dd>
          </dl>
         </div>
         <div class="section" id="use-single-quotes">
          <h2>
           Use single quotes
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#use-single-quotes" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Use single-quotes for string literals, e.g.
           <code class="docutils literal notranslate">
            <span class="pre">
             'my-identifier'
            </span>
           </code>
           ,
           <em>
            but
           </em>
           use
double-quotes for strings that are likely to contain single-quote characters as
part of the string itself (such as error messages, or any strings containing
natural language), e.g.
           <code class="docutils literal notranslate">
            <span class="pre">
             "You've
            </span>
            <span class="pre">
             got
            </span>
            <span class="pre">
             an
            </span>
            <span class="pre">
             error!"
            </span>
           </code>
           .
          </p>
          <p>
           Single-quotes are easier to read and to type, but if a string contains
single-quote characters then double-quotes are better than escaping the
single-quote characters or wrapping the string in double single-quotes.
          </p>
          <p>
           We also use triple single-quotes for docstrings, see
           <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/python.html#docstrings">
            Docstrings
           </a>
           .
          </p>
         </div>
         <div class="section" id="imports">
          <span id="id1">
          </span>
          <h2>
           Imports
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#imports" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <ul>
           <li>
            <p class="first">
             Avoid creating circular imports by only importing modules more
specialized than the one you are editing.
            </p>
            <p>
             CKAN often uses code imported into a data structure instead of
importing names directly. For example CKAN controllers only use
             <code class="docutils literal notranslate">
              <span class="pre">
               get_action
              </span>
             </code>
             to access logic functions. This allows
customization by CKAN plugins.
            </p>
            <img alt="CKAN importing diagram, general modules import more specific modules" src="./python_files/ckan_importing_diagram.png"/>
           </li>
           <li>
            <p class="first">
             Don’t use
             <code class="docutils literal notranslate">
              <span class="pre">
               from
              </span>
              <span class="pre">
               module
              </span>
              <span class="pre">
               import
              </span>
              <span class="pre">
               *
              </span>
             </code>
             . Instead list the names you
need explicitly:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="kn">from</span> <span class="nn">module</span> <span class="kn">import</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span>
</pre>
             </div>
            </div>
            <p>
             Use parenthesis around the names if they are longer than one line:
            </p>
            <div class="highlight-default notranslate">
             <div class="highlight">
              <pre><span></span><span class="kn">from</span> <span class="nn">module</span> <span class="kn">import</span> <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="o">...</span>
    <span class="n">name12</span><span class="p">,</span> <span class="n">name13</span><span class="p">)</span>
</pre>
             </div>
            </div>
            <p>
             Most of the current CKAN code base imports just the modules and
then accesses names with
             <code class="docutils literal notranslate">
              <span class="pre">
               module.name
              </span>
             </code>
             . This allows circular
imports in some cases and may still be necessary for exsiting
code, but is not recommended for new code.
            </p>
           </li>
           <li>
            <p class="first">
             Make all imports at the start of the file, after the module docstring.
Imports should be grouped in the following order:
            </p>
            <ol class="arabic simple">
             <li>
              Standard library imports
             </li>
             <li>
              Third-party imports
             </li>
             <li>
              CKAN imports
             </li>
            </ol>
           </li>
          </ul>
         </div>
         <div class="section" id="logging">
          <h2>
           Logging
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#logging" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           We use
           <a class="reference external" href="https://docs.python.org/2.7/library/logging.html">
            the Python standard library’s logging module
           </a>
           to log messages in CKAN, e.g.:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="o">...</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="o">...</span>
<span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">'some debug message'</span><span class="p">)</span>
</pre>
           </div>
          </div>
          <p>
           When logging:
          </p>
          <ul class="simple">
           <li>
            Keep log messages short.
           </li>
           <li>
            Don’t include object representations in the log message.  It
            <em>
             is
            </em>
            useful
to include a domain model identifier where appropriate.
           </li>
           <li>
            Choose an appropriate log-level (DEBUG, INFO, ERROR, WARNING or CRITICAL,
see
            <a class="reference external" href="http://docs.python.org/2/howto/logging.html">
             Python’s Logging HOWTO
            </a>
            ).
           </li>
          </ul>
         </div>
         <div class="section" id="string-formatting">
          <h2>
           String formatting
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#string-formatting" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Don’t use the old
           <code class="docutils literal notranslate">
            <span class="pre">
             %s
            </span>
           </code>
           style string formatting, e.g.
           <code class="docutils literal notranslate">
            <span class="pre">
             "i
            </span>
            <span class="pre">
             am
            </span>
            <span class="pre">
             a
            </span>
            <span class="pre">
             %s"
            </span>
            <span class="pre">
             %
            </span>
            <span class="pre">
             sub
            </span>
           </code>
           .
This kind of string formatting is not helpful for internationalization.
          </p>
          <p>
           Use the
           <a class="reference external" href="http://docs.python.org/2/library/stdtypes.html#str.format">
            new .format() method
           </a>
           instead, and give meaningful names to each
replacement field, for example:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="n">_</span><span class="p">(</span><span class="s1">' ... </span><span class="si">{foo}</span><span class="s1"> ... </span><span class="si">{bar}</span><span class="s1"> ...'</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">'foo-value'</span><span class="p">,</span> <span class="n">bar</span><span class="o">=</span><span class="s1">'bar-value'</span><span class="p">)</span>
</pre>
           </div>
          </div>
         </div>
         <div class="section" id="unicode-handling">
          <h2>
           Unicode handling
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#unicode-handling" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           CKAN strives to only use Unicode internally (via the
           <code class="docutils literal notranslate">
            <span class="pre">
             unicode
            </span>
           </code>
           type) and to
convert to/from ASCII at the interface to other systems and libraries if
necessary.
          </p>
          <div class="admonition seealso">
           <p class="first admonition-title">
            See also
           </p>
           <dl class="last docutils">
            <dt>
             <a class="reference internal" href="https://docs.ckan.org/en/2.9/contributing/unicode.html">
              <span class="doc">
               Unicode handling
              </span>
             </a>
            </dt>
            <dd>
             Details on Unicode handling in CKAN
            </dd>
           </dl>
          </div>
         </div>
         <div class="section" id="docstrings">
          <span id="id2">
          </span>
          <h2>
           Docstrings
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#docstrings" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           We want CKAN’s docstrings to be clear and easy to read for programmers who are
smart and competent but who may not know a lot of CKAN technical jargon and
whose first language may not be English. We also want it to be easy to maintain
the docstrings and keep them up to date with the actual behaviour of the code
as it changes over time. So:
          </p>
          <ul class="simple">
           <li>
            All modules and all public functions, classes and methods exported by a
module should normally have docstrings (see
            <a class="reference external" href="http://www.python.org/dev/peps/pep-0257/">
             PEP 257
            </a>
            ).
           </li>
           <li>
            Keep docstrings short, describe only what’s necessary and no more.
           </li>
           <li>
            Keep docstrings simple: use plain, concise English.
           </li>
           <li>
            Try to avoid repetition.
           </li>
          </ul>
          <div class="section" id="pep-257-docstring-conventions">
           <h3>
            PEP 257 (Docstring Conventions)
            <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#pep-257-docstring-conventions" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Generally, follow
            <a class="reference external" href="http://www.python.org/dev/peps/pep-0257/">
             PEP 257
            </a>
            for docstrings. We’ll only describe the ways that
CKAN differs from or extends PEP 257 below.
           </p>
           <p>
            CKAN docstrings deviate from PEP 257 in a couple of ways:
           </p>
           <ul class="simple">
            <li>
             We use
             <code class="docutils literal notranslate">
              <span class="pre">
               '''triple
              </span>
              <span class="pre">
               single
              </span>
              <span class="pre">
               quotes'''
              </span>
             </code>
             around docstrings, not
             <code class="docutils literal notranslate">
              <span class="pre">
               """triple
              </span>
              <span class="pre">
               double
              </span>
              <span class="pre">
               quotes"""
              </span>
             </code>
             (put triple single quotes around one-line docstrings as
well as multi-line ones, it makes them easier to expand later)
            </li>
            <li>
             We use Sphinx domain object cross-references to cross-reference to other
code objects (see below)
            </li>
            <li>
             We use Sphinx directives for documenting parameters, exceptions and return
values (see below)
            </li>
           </ul>
          </div>
         </div>
         <div class="section" id="referencing-other-code-objects-with-py">
          <span id="referencing-other-code-objects">
          </span>
          <h2>
           Referencing other code objects with
           <code class="docutils literal notranslate">
            <span class="pre">
             :py:
            </span>
           </code>
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#referencing-other-code-objects-with-py" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           If you want to refer to another Python or JavaScript module, function or class
etc. in a docstring (or from a
           <code class="docutils literal notranslate">
            <span class="pre">
             .rst
            </span>
           </code>
           file), use
           <a class="reference external" href="http://sphinx-doc.org/domains.html#cross-referencing-python-objects">
            Sphinx domain object
cross-references
           </a>
           , for
example:
          </p>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span>See :py:mod:`ckan.lib.helpers`.

See :py:func:`ckan.logic.action.create.package_create`.

See :py:class:`ckan.logic.NotFound`.
</pre>
           </div>
          </div>
          <p>
           For the full list of types of cross-reference,  see the
           <a class="reference external" href="http://sphinx-doc.org/domains.html#cross-referencing-python-objects">
            Sphinx docs
           </a>
           .
          </p>
          <div class="admonition note">
           <p class="first admonition-title">
            Note
           </p>
           <p class="last">
            These kinds of cross-references can also be used to reference other types
of object besides Python objects, for example
            <a class="reference external" href="http://sphinx-doc.org/domains.html#the-javascript-domain">
             JavaScript objects
            </a>
            or even command-line scripts and options and environment variables. See
            <a class="reference external" href="http://sphinx-doc.org/domains.html">
             the Sphinx docs
            </a>
            for the full
details.
           </p>
          </div>
          <p>
           Cross-referencing objects like this means that Sphinx will style the reference
with the right CSS, and hyperlink the reference to the docs for the referenced
object. Sphinx can also generate error messages when non-existent objects are
referenced, which helps to keep the docs up to date as the code changes.
          </p>
          <div class="admonition tip">
           <p class="first admonition-title">
            Tip
           </p>
           <p>
            Sphinx will render a cross-reference like
            <code class="docutils literal notranslate">
             <span class="pre">
              :py:func:`ckan.logic.action.create.package_create`
             </span>
            </code>
            as the full name of
the function:
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/api/index.html#ckan.logic.action.create.package_create" title="ckan.logic.action.create.package_create">
             <code class="xref py py-func docutils literal notranslate">
              <span class="pre">
               ckan.logic.action.create.package_create()
              </span>
             </code>
            </a>
            . If you want the
docs to contain only the local name of the function (e.g. just
            <a class="reference internal" href="https://docs.ckan.org/en/2.9/api/index.html#ckan.logic.action.create.package_create" title="ckan.logic.action.create.package_create">
             <code class="xref py py-func docutils literal notranslate">
              <span class="pre">
               package_create()
              </span>
             </code>
            </a>
            ), put a
            <code class="docutils literal notranslate">
             <span class="pre">
              ~
             </span>
            </code>
            at the
start:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span>:py:func:`~ckan.logic.action.create.package_create`
</pre>
            </div>
           </div>
           <p class="last">
            (But you should always use the fully qualified name in your docstring or
            <code class="docutils literal notranslate">
             <span class="pre">
              *.rst
             </span>
            </code>
            file.)
           </p>
          </div>
          <div class="section" id="documenting-exceptions-raised-with-raises">
           <h3>
            Documenting exceptions raised with
            <code class="docutils literal notranslate">
             <span class="pre">
              :raises
             </span>
            </code>
            <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#documenting-exceptions-raised-with-raises" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            There are a few guidelines that CKAN code should follow regarding exceptions:
           </p>
           <ol class="arabic">
            <li>
             <p class="first">
              <strong>
               All public functions that CKAN exports for third-party code to use
should document any exceptions they raise
              </strong>
              . See below for how to document
exceptions raised.
             </p>
             <p>
              For example the template helper functions in
              <a class="reference internal" href="https://docs.ckan.org/en/2.9/theming/template-helper-functions.html#module-ckan.lib.helpers" title="ckan.lib.helpers">
               <code class="xref py py-mod docutils literal notranslate">
                <span class="pre">
                 ckan.lib.helpers
                </span>
               </code>
              </a>
              ,
anything imported into
              <a class="reference internal" href="https://docs.ckan.org/en/2.9/extensions/plugins-toolkit.html#module-ckan.plugins.toolkit" title="ckan.plugins.toolkit">
               <code class="xref py py-mod docutils literal notranslate">
                <span class="pre">
                 ckan.plugins.toolkit
                </span>
               </code>
              </a>
              , and all of the
action API functions defined in
              <code class="xref py py-mod docutils literal notranslate">
               <span class="pre">
                ckan.logic.action
               </span>
              </code>
              , should list
exceptions raised in their docstrings.
             </p>
             <p>
              This is because CKAN themes, extensions and API clients need to be able to
call CKAN code without crashing, so they need to know what exceptions they
should handle (and extension developers shouldn’t have to understand the
CKAN core source code).
             </p>
            </li>
            <li>
             <p class="first">
              On the other hand,
              <strong>
               internal functions that are only used within CKAN
shouldn’t list exceptions in their docstrings
              </strong>
              .
             </p>
             <p>
              This is because it would be difficult to keep all the exception lists up to
date with the actual code behaviour, so the docstrings would become more
misleading than useful.
             </p>
            </li>
            <li>
             <p class="first">
              <strong>
               Code should only raise exceptions from within its allowed set
              </strong>
              .
             </p>
             <p>
              Each module in CKAN has a set of zero or more exceptions, defined somewhere
near the module, that code in that module is allowed to raise. For example
              <code class="docutils literal notranslate">
               <span class="pre">
                ckan/logic/__init__.py
               </span>
              </code>
              defines a number of exception types for code
in
              <code class="docutils literal notranslate">
               <span class="pre">
                ckan/logic/
               </span>
              </code>
              to use. CKAN code should never raise exceptions types
defined elsewhere in CKAN, in third-party code or in the Python standard
library.
             </p>
            </li>
            <li>
             <p class="first">
              <strong>
               All code should catch any exceptions raised by called functions
              </strong>
              , and
either handle the exception, re-raise the exception (if it’s from the code’s
set of allowed exception types), or wrap the exception in an allowed
exception type and re-raise it.
             </p>
             <p>
              This is to make it easy for a CKAN core developer to look at the source code
of an internal function, scan it for the keyword
              <code class="docutils literal notranslate">
               <span class="pre">
                raise
               </span>
              </code>
              , and see what
types of exception the function may raise, so they know what exceptions they
need to catch if they’re going to call the function. Developers shouldn’t
have to read the source of all the functions that a function calls (and
the functions they call…) to find out what exceptions they needs to catch
to call a function without crashing.
             </p>
            </li>
           </ol>
           <div class="admonition-todo admonition" id="index-0">
            <p class="first admonition-title">
             Todo
            </p>
            <p class="last">
             Insert examples of how to re-raise and how to wrap-and-re-raise an
exception.
            </p>
           </div>
           <p>
            Use
            <code class="docutils literal notranslate">
             <span class="pre">
              :raises:
             </span>
            </code>
            to document exceptions raised by public functions. The
docstring should say what type of exception is raised and under what
conditions. Use
            <code class="docutils literal notranslate">
             <span class="pre">
              :py:class:
             </span>
            </code>
            to reference exception types. For example:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="k">def</span> <span class="nf">member_list</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''Return the members of a group.</span>

<span class="sd">    ... (parameters and return values documented here) ...</span>

<span class="sd">    :raises: :py:class:`ckan.logic.NotFound`: if the group doesn't exist</span>

<span class="sd">    '''</span>
</pre>
            </div>
           </div>
          </div>
          <div class="section" id="sphinx-field-lists">
           <h3>
            Sphinx field lists
            <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#sphinx-field-lists" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Use
            <a class="reference external" href="http://www.sphinx-doc.org/en/stable/markup/misc.html">
             Sphinx field lists
            </a>
            for documenting the parameters, exceptions and
returns of functions:
           </p>
           <ul class="simple">
            <li>
             Use
             <code class="docutils literal notranslate">
              <span class="pre">
               :param
              </span>
             </code>
             and
             <code class="docutils literal notranslate">
              <span class="pre">
               :type
              </span>
             </code>
             to describe each parameter
            </li>
            <li>
             Use
             <code class="docutils literal notranslate">
              <span class="pre">
               :returns
              </span>
             </code>
             and
             <code class="docutils literal notranslate">
              <span class="pre">
               :rtype
              </span>
             </code>
             to describe each return
            </li>
            <li>
             Use
             <code class="docutils literal notranslate">
              <span class="pre">
               :raises
              </span>
             </code>
             to describe each exception raised
            </li>
           </ul>
           <p>
            Example of a short docstring:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''Return a list of all packages that have this tag, sorted by name.</span>

<span class="sd">    :rtype: list of ckan.model.package.Package objects</span>

<span class="sd">    '''</span>
</pre>
            </div>
           </div>
           <p>
            Example of a longer docstring:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">search_by_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">search_term</span><span class="p">,</span> <span class="n">vocab_id_or_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''Return all tags whose names contain a given string.</span>

<span class="sd">    By default only free tags (tags which do not belong to any vocabulary)</span>
<span class="sd">    are returned. If the optional argument ``vocab_id_or_name`` is given</span>
<span class="sd">    then only tags from that vocabulary are returned.</span>

<span class="sd">    :param search_term: the string to search for in the tag names</span>
<span class="sd">    :type search_term: string</span>
<span class="sd">    :param vocab_id_or_name: the id or name of the vocabulary to look in</span>
<span class="sd">        (optional, default: None)</span>
<span class="sd">    :type vocab_id_or_name: string</span>

<span class="sd">    :returns: a list of tags that match the search term</span>
<span class="sd">    :rtype: list of ckan.model.tag.Tag objects</span>

<span class="sd">    '''</span>
</pre>
            </div>
           </div>
           <p>
            The phrases that follow
            <code class="docutils literal notranslate">
             <span class="pre">
              :param
             </span>
             <span class="pre">
              foo:
             </span>
            </code>
            ,
            <code class="docutils literal notranslate">
             <span class="pre">
              :type
             </span>
             <span class="pre">
              foo:
             </span>
            </code>
            , or
            <code class="docutils literal notranslate">
             <span class="pre">
              :returns:
             </span>
            </code>
            should not start with capital letters or end with full stops. These should be
short phrases and not full sentences. If more detail is required put it in the
function description instead.
           </p>
           <p>
            Indicate optional arguments by ending their descriptions with
            <code class="docutils literal notranslate">
             <span class="pre">
              (optional)
             </span>
            </code>
            in
brackets. Where relevant also indicate the default value:
            <code class="docutils literal notranslate">
             <span class="pre">
              (optional,
             </span>
             <span class="pre">
              default:
             </span>
             <span class="pre">
              5)
             </span>
            </code>
            .
           </p>
           <p>
            You can also use a little inline
            <a class="reference external" href="http://docutils.sourceforge.net/docs/user/rst/quickref.html#inline-markup">
             reStructuredText markup
            </a>
            in docstrings, e.g.
            <code class="docutils literal notranslate">
             <span class="pre">
              *stars
             </span>
             <span class="pre">
              for
             </span>
             <span class="pre">
              emphasis*
             </span>
            </code>
            or
            <code class="docutils literal notranslate">
             <span class="pre">
              ``double-backticks
             </span>
             <span class="pre">
              for
             </span>
             <span class="pre">
              literal
             </span>
             <span class="pre">
              text``
             </span>
            </code>
           </p>
          </div>
          <div class="section" id="action-api-docstrings">
           <span id="id4">
           </span>
           <h3>
            Action API docstrings
            <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#action-api-docstrings" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Docstrings from CKAN’s action API are processed with
            <a class="reference external" href="http://sphinx.pocoo.org/ext/autodoc.html">
             autodoc
            </a>
            and
included in the API chapter of CKAN’s documentation. The intended audience of
these docstrings is users of the CKAN API and not (just) CKAN core developers.
           </p>
           <p>
            In the Python source each API function has the same two arguments (
            <code class="docutils literal notranslate">
             <span class="pre">
              context
             </span>
            </code>
            and
            <code class="docutils literal notranslate">
             <span class="pre">
              data_dict
             </span>
            </code>
            ), but the docstrings should document the keys that the
functions read from
            <code class="docutils literal notranslate">
             <span class="pre">
              data_dict
             </span>
            </code>
            and not
            <code class="docutils literal notranslate">
             <span class="pre">
              context
             </span>
            </code>
            and
            <code class="docutils literal notranslate">
             <span class="pre">
              data_dict
             </span>
            </code>
            themselves, as this is what the user has to POST in the JSON dict when calling
the API.
           </p>
           <p>
            Where practical, it’s helpful to give examples of param and return values in
API docstrings.
           </p>
           <p>
            CKAN datasets used to be called packages and the old name still appears in the
source, e.g. in function names like
            <code class="docutils literal notranslate">
             <span class="pre">
              package_list()
             </span>
            </code>
            . When documenting
functions like this write dataset not package, but the first time you do this
put package after it in brackets to avoid any confusion, e.g.
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="k">def</span> <span class="nf">package_show</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">):</span>
    <span class="s1">'''Return the metadata of a dataset (package) and its resources.</span>
</pre>
            </div>
           </div>
           <p>
            Example of a ckan.logic.action API docstring:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="k">def</span> <span class="nf">vocabulary_create</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">'''Create a new tag vocabulary.</span>

<span class="sd">    You must be a sysadmin to create vocabularies.</span>

<span class="sd">    :param name: the name of the new vocabulary, e.g. ``'Genre'``</span>
<span class="sd">    :type name: string</span>
<span class="sd">    :param tags: the new tags to add to the new vocabulary, for the format of</span>
<span class="sd">        tag dictionaries see ``tag_create()``</span>
<span class="sd">    :type tags: list of tag dictionaries</span>

<span class="sd">    :returns: the newly-created vocabulary</span>
<span class="sd">    :rtype: dictionary</span>

<span class="sd">    '''</span>
</pre>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="some-helpful-tools-for-python-code-quality">
          <h2>
           Some helpful tools for Python code quality
           <a class="headerlink" href="https://docs.ckan.org/en/2.9/contributing/python.html#some-helpful-tools-for-python-code-quality" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           There are various tools that can help you to check your Python code for PEP8
conformance and general code quality. We recommend using them.
          </p>
          <ul class="simple">
           <li>
            <a class="reference external" href="http://pypi.python.org/pypi/pep8">
             pep8
            </a>
            checks your Python code against some of the style conventions in PEP
8. As mentioned above, only perform style clean-ups on master to help avoid
spurious merge conflicts.
           </li>
           <li>
            <a class="reference external" href="http://www.logilab.org/857">
             pylint
            </a>
            analyzes Python source code looking for bugs and signs of poor
quality.
           </li>
           <li>
            <a class="reference external" href="http://pypi.python.org/pypi/pyflakes">
             pyflakes
            </a>
            also analyzes Python programs to detect errors.
           </li>
           <li>
            <a class="reference external" href="http://pypi.python.org/pypi/flake8">
             flake8
            </a>
            combines both pep8 and pyflakes into a single tool.
           </li>
           <li>
            <a class="reference external" href="https://github.com/scrooloose/syntastic">
             Syntastic
            </a>
            is a Vim plugin with support for flake8, pyflakes and pylint.
           </li>
          </ul>
         </div>
        </div>
       </div>
      </div>
      <footer>
       <div aria-label="footer navigation" class="rst-footer-buttons" role="navigation">
        <a class="btn btn-neutral float-right" href="https://docs.ckan.org/en/2.9/contributing/string-i18n.html" title="String internationalization">
         Next
         <span class="icon fa-arrow-circle-right">
         </span>
        </a>
        <a class="btn btn-neutral" href="https://docs.ckan.org/en/2.9/contributing/javascript.html" title="JavaScript coding standards">
         <span class="icon fa-arrow-circle-left">
         </span>
         Previous
        </a>
       </div>
       <hr/>
       <div>
        <div class="ethical-rtd" data-ea-manual="true" data-ea-publisher="readthedocs" data-ea-style="stickybox" data-ea-type="image" id="rtd-sidebar">
        </div>
       </div>
       <p>
        Support the
        <a href="http://ckan.org/">
         CKAN Association
        </a>
        .
       </p>
       <p class="copyright">
        © 2009-2018
        <a href="https://okfn.org/">
         Open Knowledge Foundation
        </a>
        and
        <a href="https://github.com/ckan/ckan/graphs/contributors">
         contributors
        </a>
        .
    Licensed under
        <a href="https://creativecommons.org/licenses/by-sa/3.0/">
         Creative Commons
    Attribution ShareAlike (Unported) v3.0 License
        </a>
        .
        <br/>
        <img alt="CC License Logo" src="./python_files/80x15.png"/>
        <a href="https://opendefinition.org/">
         <img alt="{{ _('Open Content') }}" border="0" src="./python_files/oc_80x15_blue.png"/>
        </a>
       </p>
       <p>
        <a href="https://github.com/ckan/ckan">
         Source
        </a>
        —
        <a href="https://github.com/ckan/ckan/issues">
         Issues
        </a>
        —
        <a href="http://lists.okfn.org/mailman/listinfo/ckan-dev">
         Mailing List
        </a>
        —
        <a href="http://twitter.com/CKANProject">
         Twitter @CKANProject
        </a>
       </p>
       <p>
        Related Projects:
        <a href="http://datacatalogs.org/">
         DataCatalogs.org
        </a>
        —
        <a href="http://openspending.org/">
         OpenSpending.org
        </a>
        —
        <a href="http://opendatahandbook.org/">
         Open Data Handbook
        </a>
       </p>
       <a href="https://github.com/snide/sphinx_rtd_theme">
        Sphinx theme
       </a>
       provided by
       <a href="https://readthedocs.org/">
        Read the Docs
       </a>
      </footer>
     </div>
    </div>
   </section>
  </div>
  <div aria-label="versions" class="rst-versions" data-toggle="rst-versions" role="note">
   <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book">
     Read the Docs
    </span>
    v: 2.9
    <span class="fa fa-caret-down">
    </span>
   </span>
   <div class="rst-other-versions">
    <!-- Inserted RTD Footer -->
    <div class="injected">
     <dl>
      <dt>
       版本
      </dt>
      <dd>
       <a href="https://docs.ckan.org/en/latest/contributing/python.html">
        latest
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/2.10/contributing/python.html">
        2.10
       </a>
      </dd>
      <dd class="rtd-current-item">
       <a href="https://docs.ckan.org/en/2.9/contributing/python.html">
        2.9
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/2.8/contributing/python.html">
        2.8
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/2.7/contributing/python.html">
        2.7
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/2.6/contributing/python.html">
        2.6
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/2.5/contributing/python.html">
        2.5
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/ckan-2.4.9/contributing/python.html">
        ckan-2.4.9
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/ckan-2.3.5/contributing/python.html">
        ckan-2.3.5
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/ckan-2.2.3/contributing/python.html">
        ckan-2.2.3
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/en/ckan-2.1.5/contributing/python.html">
        ckan-2.1.5
       </a>
      </dd>
     </dl>
     <dl>
      <dt>
       下载
      </dt>
      <dd>
       <a href="https://docs.ckan.org/_/downloads/en/2.9/pdf/">
        PDF
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/_/downloads/en/2.9/htmlzip/">
        HTML
       </a>
      </dd>
      <dd>
       <a href="https://docs.ckan.org/_/downloads/en/2.9/epub/">
        Epub
       </a>
      </dd>
     </dl>
     <dl>
      <!-- These are kept as relative links for internal installs that are http -->
      <dt>
       在 Read the Docs 上
      </dt>
      <dd>
       <a href="https://readthedocs.org/projects/ckan/">
        项目主页
       </a>
      </dd>
      <dd>
       <a href="https://readthedocs.org/projects/ckan/builds/">
        构建
       </a>
      </dd>
      <dd>
       <a href="https://readthedocs.org/projects/ckan/downloads/">
        下载
       </a>
      </dd>
     </dl>
     <dl>
      <dt>
       在 GitHub 上
      </dt>
      <dd>
       <a href="https://github.com/ckan/ckan/blob/2.9/doc/contributing/python.rst">
        查看
       </a>
      </dd>
      <dd>
       <a href="https://github.com/ckan/ckan/edit/2.9/doc/contributing/python.rst">
        编辑
       </a>
      </dd>
     </dl>
     <dl>
      <dt>
       搜索
      </dt>
      <dd>
       <div style="padding: 6px;">
        <form action="https://readthedocs.org/projects/ckan/search/" class="wy-form" id="flyout-search-form" method="get" target="_blank">
         <input aria-label="搜索文档" name="q" placeholder="搜索文档" type="text"/>
        </form>
       </div>
      </dd>
     </dl>
     <hr/>
     <small>
      <span>
       托管于
       <a href="https://readthedocs.org/">
        Read the Docs
       </a>
      </span>
      <span>
       ·
      </span>
      <a href="https://docs.readthedocs.io/page/privacy-policy.html">
       隐私政策
      </a>
     </small>
    </div>
   </div>
  </div>
  <script type="text/javascript">
   jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 </body>
</html>
